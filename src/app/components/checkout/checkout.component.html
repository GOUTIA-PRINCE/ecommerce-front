<div class="main-content page-m checkout">
    <div class="section-content section-content-p30">
        <div class="container-fluid">

            <form [formGroup]="checkoutFormGroup" (ngSubmit)="onSubmit()" class="checkout-form">
                <div class="checkout-shell">
                    <div class="checkout-stepper">
                        <div class="checkout-step" [class.is-active]="currentStep === 1" [class.is-done]="currentStep > 1">
                            <span class="checkout-step__index">1</span>
                            <span class="checkout-step__label">Customer</span>
                        </div>
                        <div class="checkout-step" [class.is-active]="currentStep === 2" [class.is-done]="currentStep > 2">
                            <span class="checkout-step__index">2</span>
                            <span class="checkout-step__label">Shipping</span>
                        </div>
                        <div class="checkout-step" [class.is-active]="currentStep === 3" [class.is-done]="currentStep > 3">
                            <span class="checkout-step__index">3</span>
                            <span class="checkout-step__label">Billing</span>
                        </div>
                        <div class="checkout-step" [class.is-active]="currentStep === 4" [class.is-done]="currentStep > 4">
                            <span class="checkout-step__index">4</span>
                            <span class="checkout-step__label">Payment</span>
                        </div>
                        <div class="checkout-step" [class.is-active]="currentStep === 5">
                            <span class="checkout-step__index">5</span>
                            <span class="checkout-step__label">Review</span>
                        </div>
                    </div>

                    <!-- customer form group -->
                    <div formGroupName="customer" class="form-area checkout-card" *ngIf="currentStep === 1">

                        <div class="row">
                            <div class="col-md-2"> <label>First Name</label></div>
                            <div class="col-md-9">
                                <div class="input-space">
                                    <input formControlName="firstName" type="text">

                                    <div *ngIf="firstName?.invalid &&(firstName?.dirty||firstName?.touched)" class="alert alert-danger mt-1">
                                        <div *ngIf="firstName?.errors?.['required'] || firstName?.errors?.['notOnlyWhitespace']">
                                            First Name is required
                                        </div>
                                        <div *ngIf="firstName?.errors?.['minlength']">
                                            First Name must be at least 2 characters long
                                        </div>
                                         
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-2"> <label>Last Name</label></div>
                            <div class="col-md-9">
                                <div class="input-space">
                                    <input formControlName="lastName" type="text">

                                    <div *ngIf="lastName?.invalid &&(lastName?.dirty||lastName?.touched)" class="alert alert-danger mt-1">
                                        <div *ngIf="lastName?.errors?.['required'] || lastName?.errors?.['notOnlyWhitespace'] " >
                                            Last Name is required
                                        </div>
                                        <div *ngIf="lastName?.errors?.['minlength']">
                                            Last Name must be at least 2 characters long
                                        </div>
                                         
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-2"> <label>Email</label></div>
                            <div class="col-md-9">
                                <div class="input-space">
                                    <input formControlName="email" type="text">

                                    <div *ngIf="email?.invalid &&(email?.dirty||email?.touched)" class="alert alert-danger mt-1">
                                        <div *ngIf="email?.errors?.['required']">
                                            Email  is required
                                        </div>
                                        <div *ngIf="email?.errors?.['pattern']">
                                            Email must be a valid email adress format
                                        </div>
                                         
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- shipping Address -->
                    <div formGroupName="shippingAddress" class="form-area checkout-card" *ngIf="currentStep === 2">

                        <div class="row">
                            <div class="col-md-2"> <label>Country</label></div>
                            <div class="col-md-9">
                                <div class="input-space">
                                    <select formControlName="country" (change)="getStates('shippingAddress')">
                                        <option *ngFor="let country of countries" [ngValue]="country">
                                            {{ country.name }}
                                        </option>
                                    </select>
                                    <div *ngIf="shippingAddressCountry?.invalid && (shippingAddressCountry?.dirty || shippingAddressCountry?.touched)" 
                                    class="alert alert-danger mt-1">
                                   <div *ngIf="shippingAddressCountry?.errors?.['required']">
                                       Country is required
                                   </div>
                               </div>
                               
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-2"> <label>Street</label></div>
                            <div class="col-md-9">
                                <div class="input-space">
                                    <input formControlName="street" type="text">

                                    <div *ngIf="shippingAddressStreet?.invalid && (shippingAddressStreet?.dirty || shippingAddressStreet?.touched)" 
                                    class="alert alert-danger mt-1">
                                   <div *ngIf="shippingAddressStreet?.errors?.['required']|| shippingAddressStreet?.errors?.['notOnlyWhitespace']">
                                       Street is required
                                   </div>
                                   <div *ngIf="shippingAddressStreet?.errors?.['minlength'] ">
                                    Street must be at least 2 characters long
                                </div>
                               </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-2"> <label>City</label></div>
                            <div class="col-md-9">
                                <div class="input-space">
                                    <input formControlName="city" type="text">

                                    <div *ngIf="shippingAddressCity?.invalid && (shippingAddressCity?.dirty || shippingAddressCity?.touched)" 
                                    class="alert alert-danger mt-1">
                                   <div *ngIf="shippingAddressCity?.errors?.['required'] || shippingAddressCity?.errors?.['notOnlyWhitespace']">
                                       City is required
                                   </div>
                                   <div *ngIf="shippingAddressCity?.errors?.['minlength'] ">
                                    City must be at least 2 characters long
                                </div>
                               </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-2"> <label>State</label></div>
                            <div class="col-md-9">
                                <div class="input-space">
                                    <select formControlName="state">
                                        <option *ngFor="let state of shippingAddressStates" [ngValue]="state">
                                            {{ state.name }}
                                        </option>
                                    </select>

                                    <div *ngIf="shippingAddressState?.invalid && (shippingAddressState?.dirty || shippingAddressState?.touched)" 
                                    class="alert alert-danger mt-1">
                                   <div *ngIf="shippingAddressState?.errors?.['required']">
                                       State is required
                                   </div>
                               </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-2"> <label>Zip Code</label></div>
                            <div class="col-md-9">
                                <div class="input-space">
                                    <input formControlName="zipCode" type="text">

                                    <div *ngIf="shippingAddressZipcode?.invalid && (shippingAddressZipcode?.dirty || shippingAddressZipcode?.touched)" 
                                    class="alert alert-danger mt-1">
                                   <div *ngIf="shippingAddressZipcode?.errors?.['required'] || shippingAddressZipcode?.errors?.['notOnlyWhitespace']">
                                       Zip code is required
                                   </div>
                                   <div *ngIf="shippingAddressZipcode?.errors?.['minlength'] ">
                                    Zip code must be at least 2 characters long
                                </div>
                               </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Billing Address -->
                    <div formGroupName="billingAddress" class="form-area checkout-card" *ngIf="currentStep === 3">

                        <div class="input-space checkout-toggle">
                            <label class="au-checkbox">
                                <input type="checkbox" (change)="copyShippingAddressToBillingAddress($event)">
                                <span class="au-checkmark"></span>Billing Address same as Shipping Address
                            </label>
                        </div>

                        <div class="row">
                            <div class="col-md-2"> <label>Country</label></div>
                            <div class="col-md-9">
                                <div class="input-space">
                                    <select formControlName="country" (change)="getStates('billingAddress')">
                                        <option *ngFor="let country of countries" [ngValue]="country">
                                            {{ country.name }}
                                        </option>
                                    </select>
                                    <div *ngIf="billingAddressCountry?.invalid && (billingAddressCountry?.dirty || billingAddressCountry?.touched)" 
                                    class="alert alert-danger mt-1">
                                   <div *ngIf="billingAddressCountry?.errors?.['required']">
                                       Country is required
                                   </div>
                               </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-2"> <label>Street</label></div>
                            <div class="col-md-9">
                                <div class="input-space">
                                    <input formControlName="street" type="text">

                                    <div *ngIf="billingAddressStreet?.invalid && (billingAddressStreet?.dirty || billingAddressStreet?.touched)" 
                                    class="alert alert-danger mt-1">
                                   <div *ngIf="billingAddressStreet?.errors?.['required']|| billingAddressStreet?.errors?.['notOnlyWhitespace']">
                                       Street is required
                                   </div>
                                   <div *ngIf="billingAddressStreet?.errors?.['minlength'] ">
                                    Street be at least 2 characters long
                                </div>
                               </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-2"> <label>City</label></div>
                            <div class="col-md-9">
                                <div class="input-space">
                                    <input formControlName="city" type="text">

                                    <div *ngIf="billingAddressCity?.invalid && (billingAddressCity?.dirty || billingAddressCity?.touched)" 
                                    class="alert alert-danger mt-1">
                                   <div *ngIf="billingAddressCity?.errors?.['required'] || billingAddressCity?.errors?.['notOnlyWhitespace']">
                                       City is required
                                   </div>
                                   <div *ngIf="billingAddressCity?.errors?.['minlength'] ">
                                    City be at least 2 characters long
                                </div>
                               </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-2"> <label>State</label></div>
                            <div class="col-md-9">
                                <div class="input-space">
                                    <select formControlName="state">
                                        <option *ngFor="let state of billingAddressStates" [ngValue]="state">
                                            {{ state.name }}
                                        </option>
                                    </select>
                                    <div *ngIf="billingAddressState?.invalid && (billingAddressState?.dirty || billingAddressState?.touched)" 
                                    class="alert alert-danger mt-1">
                                   <div *ngIf="billingAddressState?.errors?.['required']">
                                       State is required
                                   </div>
                               </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-2"> <label>Zip Code</label></div>
                            <div class="col-md-9">
                                <div class="input-space">
                                    <input formControlName="zipCode" type="text">

                                    <div *ngIf="billingAddressZipcode?.invalid && (billingAddressZipcode?.dirty || billingAddressZipcode?.touched)" 
                                    class="alert alert-danger mt-1">
                                   <div *ngIf="billingAddressZipcode?.errors?.['required'] || billingAddressZipcode?.errors?.['notOnlyWhitespace']">
                                       Zip code is required
                                   </div>
                                   <div *ngIf="billingAddressZipcode?.errors?.['minlength'] ">
                                    Zip code must be at least 2 characters long
                                </div>
                               </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Payment -->
                    <div class="form-area checkout-card" *ngIf="currentStep === 4">

                        <div class="checkout-payment">
                            <label class="checkout-payment__option">
                                <input type="radio" formControlName="paymentMethod" value="card">
                                <span class="checkout-payment__label">Credit Card</span>
                            </label>
                            <label class="checkout-payment__option">
                                <input type="radio" formControlName="paymentMethod" value="orangeMoney">
                                <span class="checkout-payment__label">Orange Money (CM)</span>
                            </label>
                            <label class="checkout-payment__option">
                                <input type="radio" formControlName="paymentMethod" value="momo">
                                <span class="checkout-payment__label">MTN MoMo (CM)</span>
                            </label>
                        </div>

                        <div *ngIf="paymentMethod?.invalid && (paymentMethod?.dirty || paymentMethod?.touched)" class="alert alert-danger mt-2">
                            Please select a payment method
                        </div>

                        <div class="checkout-payment__form" *ngIf="paymentMethod?.value === 'card'" formGroupName="creditCard">
                            <div class="row">
                                <div class="col-md-2"> <label>Card Type</label></div>
                                <div class="col-md-9">
                                    <div class="input-space">
                                        <select formControlName="cardType">
                                            <option>Visa</option>
                                            <option>Mastercard</option>
                                        </select>

                                        <div *ngIf="creditCardType?.invalid && (creditCardType?.dirty || creditCardType?.touched)" 
                                        class="alert alert-danger mt-1">
                                       <div *ngIf="creditCardType?.errors?.['required']">
                                           Credit Card type is required
                                       </div>
                                   </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-2"> <label>Name on Card</label></div>
                                <div class="col-md-9">
                                    <div class="input-space">
                                        <input formControlName="nameOnCard" type="text">
                                        <div *ngIf="creditCardNameOnCard?.invalid && (creditCardNameOnCard?.dirty || creditCardNameOnCard?.touched)" 
                                        class="alert alert-danger mt-1">
                                       <div *ngIf="creditCardNameOnCard?.errors?.['required'] || creditCardNameOnCard?.errors?.['notOnlyWhitespace']">
                                        Name  is required
                                       </div>
                                       <div *ngIf="creditCardNameOnCard?.errors?.['minlength'] ">
                                        Name  must be at least 2 characters long
                                       </div>
                                   </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-2"> <label>Card Number</label></div>
                                <div class="col-md-9">
                                    <div class="input-space">
                                        <input formControlName="cardNumber" type="text">

                                        <div *ngIf="creditCardNumber?.invalid && (creditCardNumber?.dirty || creditCardNumber?.touched)" 
                                        class="alert alert-danger mt-1">
                                       <div *ngIf="creditCardNumber?.errors?.['required']">
                                            Card Number is required
                                       </div>
                                       <div *ngIf="creditCardNumber?.errors?.['pattern']">
                                        Card Number  must be 16 digits long
                                   </div>
                                   </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-2"> <label>Security Code</label></div>
                                <div class="col-md-9">
                                    <div class="input-space">
                                        <input formControlName="securityCode" type="text">

                                        <div *ngIf="creditCardSecurityCode?.invalid && (creditCardSecurityCode?.dirty || creditCardSecurityCode?.touched)" 
                                        class="alert alert-danger mt-1">
                                       <div *ngIf="creditCardSecurityCode?.errors?.['required']">
                                        Security Code is required
                                       </div>
                                       <div *ngIf="creditCardSecurityCode?.errors?.['pattern']">
                                        Security Code  must be 3 or 4 digits long
                                   </div>
                                   </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-2"> <label>Expiration Month</label></div>
                                <div class="col-md-9">
                                    <div class="input-space">
                                        <select formControlName="expirationMonth">
                                            <option *ngFor="let month of creditCardMonths">
                                                {{ month }}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-2"> <label>Expiration Year</label></div>
                                <div class="col-md-9">
                                    <div class="input-space">
                                        <select formControlName="expirationYear" (change)="handleMonthsAndYears()">
                                            <option *ngFor="let year of creditCardYears">
                                                {{ year }}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="checkout-payment__form" *ngIf="paymentMethod?.value === 'orangeMoney'" formGroupName="orangeMoney">
                            <div class="row">
                                <div class="col-md-2"> <label>Mobile Number</label></div>
                                <div class="col-md-9">
                                    <div class="input-space">
                                        <input formControlName="mobileNumber" type="text">
                                        <div *ngIf="orangeMoneyMobileNumber?.invalid && (orangeMoneyMobileNumber?.dirty || orangeMoneyMobileNumber?.touched)"
                                        class="alert alert-danger mt-1">
                                            <div *ngIf="orangeMoneyMobileNumber?.errors?.['required']">
                                                Mobile number is required
                                            </div>
                                            <div *ngIf="orangeMoneyMobileNumber?.errors?.['pattern']">
                                                Mobile number must be digits only
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-2"> <label>Full Name</label></div>
                                <div class="col-md-9">
                                    <div class="input-space">
                                        <input formControlName="fullName" type="text">
                                        <div *ngIf="orangeMoneyFullName?.invalid && (orangeMoneyFullName?.dirty || orangeMoneyFullName?.touched)"
                                        class="alert alert-danger mt-1">
                                            <div *ngIf="orangeMoneyFullName?.errors?.['required'] || orangeMoneyFullName?.errors?.['notOnlyWhitespace']">
                                                Full name is required
                                            </div>
                                            <div *ngIf="orangeMoneyFullName?.errors?.['minlength']">
                                                Full name must be at least 2 characters long
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="checkout-payment__form" *ngIf="paymentMethod?.value === 'momo'" formGroupName="momo">
                            <div class="row">
                                <div class="col-md-2"> <label>Mobile Number</label></div>
                                <div class="col-md-9">
                                    <div class="input-space">
                                        <input formControlName="mobileNumber" type="text">
                                        <div *ngIf="momoMobileNumber?.invalid && (momoMobileNumber?.dirty || momoMobileNumber?.touched)"
                                        class="alert alert-danger mt-1">
                                            <div *ngIf="momoMobileNumber?.errors?.['required']">
                                                Mobile number is required
                                            </div>
                                            <div *ngIf="momoMobileNumber?.errors?.['pattern']">
                                                Mobile number must be digits only
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-2"> <label>Full Name</label></div>
                                <div class="col-md-9">
                                    <div class="input-space">
                                        <input formControlName="fullName" type="text">
                                        <div *ngIf="momoFullName?.invalid && (momoFullName?.dirty || momoFullName?.touched)"
                                        class="alert alert-danger mt-1">
                                            <div *ngIf="momoFullName?.errors?.['required'] || momoFullName?.errors?.['notOnlyWhitespace']">
                                                Full name is required
                                            </div>
                                            <div *ngIf="momoFullName?.errors?.['minlength']">
                                                Full name must be at least 2 characters long
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-area checkout-card checkout-summary" *ngIf="currentStep === 5">

                        <p>Total Quantity: {{ totalQuantity }}</p>
                        <p>Shipping: FREE</p>
                        <p>Total Price: {{ totalPrice | currency: 'USD' }}</p>
                    </div>

                    <div class="checkout-nav">
                        <button type="button" class="btn btn-outline-secondary" (click)="prevStep()" [disabled]="currentStep === 1">
                            Back
                        </button>
                        <button type="button" class="btn btn-info" (click)="nextStep()" *ngIf="currentStep < 5">
                            Next
                        </button>
                        <button type="submit" class="btn btn-info checkout-submit__btn" *ngIf="currentStep === 5">
                            Purchase
                        </button>
                    </div>
                </div>

            </form>

        </div>
    </div>
</div>
